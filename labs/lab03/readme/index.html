
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Labs for MSE404.">
      
      
        <meta name="author" content="Johannes Lischner">
      
      
      
        <link rel="prev" href="../../lab02/readme/">
      
      
        <link rel="next" href="../../lab04/readme/">
      
      
      <link rel="icon" href="../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Lab 3 - Convergence and Importance Parameters - MSE404</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="light" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#convergence-and-importance-parameters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="MSE404" class="md-header__button md-logo" aria-label="MSE404" data-md-component="logo">
      
  <img src="../../../assets/IMPV2.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSE404
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 3 - Convergence and Importance Parameters
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="light" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chengcheng-Xiao/mse404" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Chengcheng-Xiao/mse404
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="MSE404" class="md-nav__button md-logo" aria-label="MSE404" data-md-component="logo">
      
  <img src="../../../assets/IMPV2.svg" alt="logo">

    </a>
    MSE404
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chengcheng-Xiao/mse404" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Chengcheng-Xiao/mse404
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab01/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 1 - Getting Started in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab02/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 2 - Quantum Espresso Input and Output for Molecules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Lab 3 - Convergence and Importance Parameters
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Lab 3 - Convergence and Importance Parameters
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux-recap" class="md-nav__link">
    <span class="md-ellipsis">
      Linux Recap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudopotentials" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudopotentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plane-wave-energy-cut-off" class="md-nav__link">
    <span class="md-ellipsis">
      Plane-wave energy cut-off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Shell scripting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell scripting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_1" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_2" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plotting-with-gnuplot" class="md-nav__link">
    <span class="md-ellipsis">
      Plotting with Gnuplot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plotting with Gnuplot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task_3" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exchange-correlation-functional" class="md-nav__link">
    <span class="md-ellipsis">
      Exchange &amp; Correlation Functional
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exchange & Correlation Functional">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task_4" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_5" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra" class="md-nav__link">
    <span class="md-ellipsis">
      Extra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#box-size" class="md-nav__link">
    <span class="md-ellipsis">
      Box-Size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-task" class="md-nav__link">
    <span class="md-ellipsis">
      Optional Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-shell-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Shell scripting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab04/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 4 - Crystals and Electronic Band Structures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab05/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 5 - Forces, Stresses and Structures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab06/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 6 - Vibrational Frequencies and Normal Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab07/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 7 - Finite Temperature Properties
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab08/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 8 - Metals, Spin Polarization and Magnetic Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lab09/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 9 - Charged system and excited states
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extra labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Extra labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/using_total_energies/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/visualising_output/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/hydrogen_atom/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/tetrahedron_method/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/tddft/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/labs/high_symmetry_points/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ex Lab 6
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Extra resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Extra resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/misc/vmsetup/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual machines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/misc/linuxcommands/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/misc/gnuplot/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gnuplot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/misc/shellscripting/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bash scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extras/misc/running_in_parallel/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallel computing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux-recap" class="md-nav__link">
    <span class="md-ellipsis">
      Linux Recap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudopotentials" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudopotentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plane-wave-energy-cut-off" class="md-nav__link">
    <span class="md-ellipsis">
      Plane-wave energy cut-off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Shell scripting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell scripting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_1" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_2" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plotting-with-gnuplot" class="md-nav__link">
    <span class="md-ellipsis">
      Plotting with Gnuplot
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plotting with Gnuplot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task_3" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exchange-correlation-functional" class="md-nav__link">
    <span class="md-ellipsis">
      Exchange &amp; Correlation Functional
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exchange & Correlation Functional">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task_4" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_5" class="md-nav__link">
    <span class="md-ellipsis">
      Task
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra" class="md-nav__link">
    <span class="md-ellipsis">
      Extra
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#box-size" class="md-nav__link">
    <span class="md-ellipsis">
      Box-Size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-task" class="md-nav__link">
    <span class="md-ellipsis">
      Optional Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-shell-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Shell scripting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="convergence-and-importance-parameters">Convergence and Importance Parameters</h1>
<p>In this lab we'll continue looking at molecules, and we'll also be going
through how to define various input parameters and how to check how well
converged your calculations are.</p>
<p><strong>Reminder</strong> Don't forget to copy the <code>lab03</code> folder from <code>/opt/Courses/MSE404/lab03</code>
to your home directory.</p>
<h2 id="linux-recap">Linux Recap</h2>
<p>Before you start, if you can't remember how to do something from the command
line, this <a href="https://www.slideshare.net/NoFernndezPozo/unix-command-sheet2014">cheat
sheet</a> may
come in useful. Or you can always refer back to <a href="../../lab01/readme/">lab 1</a>.</p>
<p>Although it's not essential, at some point you may wish to transfer files between
different computers. You can do this using the <code>scp</code> command. This
<a href="https://linuxize.com/post/how-to-use-scp-command-to-securely-transfer-files/">website</a>
explains how to use it. There are also some other useful commands which we
haven't discussed <a href="../../extras/misc/linuxcommands/readme/"><code>here</code></a>.</p>
<h2 id="pseudopotentials">Pseudopotentials</h2>
<p>As discussed in lectures, pseudopotentials are used to approximate the core
potential. For each atomic species, you need a file which describes
the approximation you want the DFT code to use for that species. As
you've seen we set the input files to look in the current directory for the
required pseudopotential file. This is done by setting <code>pseudo_dir = '.'</code> in the
<code>CONTROL</code> section of the input, where <code>.</code> represents the current directory.
We then use a link to this file from some central directory rather than making
multiple copies of the pseudopotential for different calculations. This week
we'll be doing some different molecules. As always we need to make sure each
of the atomic species have a pseudopotential listed in the input file.</p>
<p>An alternative way to do this would be to specify the central pseudopotential
directory directly in the input file. We've set this in the input file in
<a href="../01_carbon_dioxide/CO2.in"><code>01_carbon_dioxide/CO2.in</code></a>.</p>
<ul>
<li>Take a look at the directory contents and you'll see there's only an
  input file there.</li>
<li>Compare this to one of the input files from <a href="../../lab02/readme/">lab 2</a> and
  run the calculation to check it works. Note that you do not need to edit the
  file.</li>
<li>Take a look at the pseudopotential file we've used for oxygen. The header
  has some useful information regarding how the pseudopotential was generated,
  such as what states are included, and what approximations are used for
  exchange and correlation.</li>
</ul>
<h2 id="plane-wave-energy-cut-off">Plane-wave energy cut-off</h2>
<p>Regardless of the type of system you're looking at, you'll need to check how
well converged your result is (whatever it is your calculating) with respect
to the plane-wave energy cut-off. This governs how many plane-waves are
used in the calculation.</p>
<ul>
<li>In Quantum Espresso this is controlled with the parameter <code>ecutwfc</code>.</li>
<li>Different systems will converge differently - for example you shouldn't
  expect diamond and silicon to be converged to the same accuracy with the same
  energy cut-off despite having the same structure and same number of
  valence electrons.</li>
<li>Different pseudopotentials for the same atomic species will also converge
  differently. Often pseudopotential files will suggest an energy cut-off.</li>
<li>Different calculated parameters will converge differently.<ul>
<li>You should be particularly careful when calculating parameters that
  depend on volume, as the number of plane-waves for a given energy
  cut-off is directly proportional to the volume so this can introduce
  an additional variation. We'll see more about this later.</li>
</ul>
</li>
</ul>
<p>An example showing the total energy convergence with respect to energy cut-off
is in the <a href="02_ecut/01_carbon_dioxide">02_ecut/01_carbon_dioxide</a> directory. We
have already set up a series of input files which are all identical except we
systematically increase the value of <code>ecutwfc</code>.</p>
<p>Examine one of these input files. You'll notice we've specified some
additional variables:</p>
<ul>
<li>In the <code>CONTROL</code> section we've added the setting <code>disk_io = 'none'</code>. This
  suppresses the generation of the wavefunction file and the folder with the
  charge density etc. If we only care about the total energy we don't need to
  generate these files, and the calculation will run a little faster if it's
  not trying to write unnecessary files as disk I/O can often be a bottleneck
  in calculations.</li>
<li>In the <code>ELECTRONS</code> section we have added the <code>conv_thr</code> setting, though it
  is set to its default value. This variable controls when the self
  consistency cycle finishes. You should be aware of this variable, as there
  is little point in trying to converge to greater accuracy than we are
  converging self-consistently.</li>
</ul>
<p>So now we want to run <code>pw.x</code> for each of these input files. <strong>Don't forget
you'll need to load the espresso module and its dependencies before the
<code>pw.x</code> command will work.</strong></p>
<p>It's a little tedious to type out the <code>pw.x</code> command for each input file in
turn manually. Instead we can automate this with a small script.</p>
<h2 id="shell-scripting">Shell scripting</h2>
<p>A shell script is a collection of Linux shell commands in a file, and when
that file is executed (in the same way as any Linux command is executed) then
those commands are executed. We could make a script that explicitly runs each
input file with <code>pw.x</code> in turn as follows:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-0-2">
</span><span id="__span-0-3"><span class="c1"># Run pw.x for each input file sequentially</span>
</span><span id="__span-0-4">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_10.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_10.out
</span><span id="__span-0-5">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_15.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_15.out
</span><span id="__span-0-6">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_20.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_20.out
</span><span id="__span-0-7">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_25.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_25.out
</span><span id="__span-0-8">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_30.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_30.out
</span><span id="__span-0-9">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_35.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_35.out
</span><span id="__span-0-10">pw.x<span class="w"> </span>&lt;<span class="w"> </span>CO2_40.in<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>CO2_40.out
</span></code></pre></div></td></tr></table></div>
<p>If we save this in a file called say <code>run_set.sh</code> (e.g. by copying the above 
to whichever text editor you prefer such as <code>gedit</code>), the simplest way to run the
script is using <code>bash run_set.sh</code>, where bash is the default shell on the system 
we're using. This means that the same commands you type in a terminal can be used
in a bash script. In other words this script does the same thing as if we typed
each line directly. It is also possible to execute the script directly using
<code>./run_set.sh</code>, which would rquire you to set the file to executable, using
<a href="../../extras/misc/linuxcommands/readme/#chmod"><code>chmod</code></a>.</p>
<p>There are also a number of features available in <code>bash</code> to make scripts more
general than an explicit set of commands. For example, let's say we want to
instead find whatever input files are in the current directory, and run
<code>pw.x</code> with them, saving the output in an appropriate file, we could make our
script as follows:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-1-2">
</span><span id="__span-1-3"><span class="c1"># Loop over files in the current directory with extension .in</span>
</span><span id="__span-1-4"><span class="k">for</span><span class="w"> </span>input_file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>*.in<span class="k">)</span>
</span><span id="__span-1-5"><span class="w">   </span><span class="c1"># For each file run pw.x and save output in file with same </span>
</span><span id="__span-1-6"><span class="w">   </span><span class="c1"># root name as input file but with .out extension</span>
</span><span id="__span-1-7"><span class="w">   </span><span class="k">do</span>
</span><span id="__span-1-8"><span class="w">      </span>pw.x<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$input_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">input_file</span><span class="p">%.*</span><span class="si">}</span><span class="s2">.out&quot;</span>
</span><span id="__span-1-9"><span class="k">done</span>
</span></code></pre></div></td></tr></table></div>
<p>In this script, we save the output of an <code>ls</code> command listing all the input
files with <code>.in</code> extension as a variable. Then we loop over those input files, 
running <code>pw.x</code> with each, and saving the output in a file that has the same name as the input
file but with the extension <code>.out</code> instead of <code>.in</code>. The part
<code>${input_file%.*}</code> returns the value stored in the <code>$input_file</code> variable
but with the extension stripped away. This lets us make our script much more
general: if we add additional input files, they'll automatically be picked
up and run without us needing to modify our script.</p>
<h3 id="task"><em>Task</em></h3>
<ul>
<li>Save this second script as <code>run_all.sh</code> and run it within the directory
   with the carbon dioxide input files using <code>bash run_all.sh</code>.</li>
<li>Check one of your output files to make sure Quantum Espresso ran
   as expected. If your file contains only an error message, you likely forgot
   to load the modules required to use Quantum Espresso on our server.</li>
</ul>
<p>Once the calculations have run, we want to see how the total energy changes
with the input plane-wave energy cut-off. We could go through each output
file and find the resulting total energy and gather them in a file, but again
that would be tedious so we can write a script to do it for us (or extend
our earlier script to also do this).</p>
<p>There are two different commands we could use to extract the resulting total
energy from file. The first is often simpler to use and is called
<a href="../../extras/misc/linuxcommands/readme/#grep"><code>grep</code></a>. For example we could use
the following to print the line containing the final total energy from each
output file using the fact that <code>pw.x</code> helpfully starts this line with a <code>!</code>:
<code>grep '^!.*total energy' *out</code>. In particular, we are searching for a line which
has the symbol <code>!</code> at the beginning <code>^</code> and that also contains the string <code>total
energy</code> in all files whose names end with <code>out</code>. Try running this now in the
directory containing your output files.</p>
<p>The other command we could use is
<a href="../../extras/misc/linuxcommands/readme/#awk"><code>awk</code></a>, which is more powerful, but
also more complicate to use, and lets us pick out both the total energy value
and the energy cut-off that was used with a single command. We could use this in
a simple script as follows:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-2-2">
</span><span id="__span-2-3"><span class="c1"># In all files ending with &#39;out&#39;, find line with &#39;kinetic-energy&#39; </span>
</span><span id="__span-2-4"><span class="c1"># and save the fourth column/word into variable &#39;ecut&#39;. </span>
</span><span id="__span-2-5"><span class="c1"># Then in the same file also find a line beginning with &#39;!&#39; and that contains</span>
</span><span id="__span-2-6"><span class="c1"># the string &#39;total&#39; and print the value stored in &#39;ecut&#39; and the</span>
</span><span id="__span-2-7"><span class="c1"># fifth column/word from this line.</span>
</span><span id="__span-2-8">awk<span class="w"> </span><span class="s1">&#39;/kinetic-energy/{ecut=$4} /^!.*total/{print ecut, $5}&#39;</span><span class="w"> </span>*out
</span></code></pre></div></td></tr></table></div>
<p>Here we use the <code>awk</code> command to find the line with <code>kinetic-energy</code> and save
the fourth word (<code>$4</code>) to a variable called <code>ecut</code>. Then when it finds a line
that starts with a <code>!</code> and has the word <code>total</code>, it will output the value
stored in the <code>ecut</code> variable, followed by the fifth word (<code>$5</code>) on that line.</p>
<h3 id="task_1"><em>Task</em></h3>
<ul>
<li>Save this as a script called <code>etot_v_ecut.sh</code>, run it in the directory with
   the output files and save the output as <code>etot_v_ecut.dat</code>. You can do this
   by typing <code>bash etot_v_ecut.sh &gt; etot_v_ecut.dat</code>.</li>
<li>Look at the output (e.g. using <code>gedit</code>) and you can see to how many significant
   figures the total energy is converged for a given energy cut-off.</li>
</ul>
<p>We can make things even easier if rather than manually generating all the input
files, we modify the script to take a base input file and modify it for each
calculation, run it, and finally parse the output to a data file.</p>
<p>This is in the <code>02_ecut/02_methane</code> directory.</p>
<p>The script is as follows:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-3-2">
</span><span id="__span-3-3"><span class="c1"># Original filename</span>
</span><span id="__span-3-4"><span class="nv">template</span><span class="o">=</span><span class="s2">&quot;CH4_base.in&quot;</span>
</span><span id="__span-3-5"><span class="c1"># String to be replaced</span>
</span><span id="__span-3-6"><span class="nv">repstr</span><span class="o">=</span><span class="s2">&quot;xxxx&quot;</span>
</span><span id="__span-3-7">
</span><span id="__span-3-8"><span class="c1"># Loop from 10 to 50 in steps of 5. These are the values of the energy cut-off</span>
</span><span id="__span-3-9"><span class="k">for</span><span class="w"> </span>val<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">10</span>..50..5<span class="o">}</span>
</span><span id="__span-3-10"><span class="k">do</span>
</span><span id="__span-3-11"><span class="w">  </span><span class="c1"># Define input file name. Assign at each file a specific name</span>
</span><span id="__span-3-12"><span class="w">  </span><span class="nv">inp</span><span class="o">=</span><span class="s2">&quot;CH4_</span><span class="si">${</span><span class="nv">val</span><span class="si">}</span><span class="s2">.in&quot;</span>
</span><span id="__span-3-13"><span class="w">  </span><span class="c1"># Substitute &quot;xxxx&quot; string in original file with the current energy cut-off value</span>
</span><span id="__span-3-14"><span class="w">  </span><span class="c1"># and paste the result into new input file</span>
</span><span id="__span-3-15"><span class="w">  </span>sed<span class="w"> </span><span class="s2">&quot;s/</span><span class="nv">$repstr</span><span class="s2">/</span><span class="nv">$val</span><span class="s2">/&quot;</span><span class="w"> </span><span class="nv">$template</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$inp</span>
</span><span id="__span-3-16"><span class="w">  </span><span class="c1"># Run pw.x on the current input file</span>
</span><span id="__span-3-17"><span class="w">  </span>pw.x<span class="w"> </span>&lt;<span class="w"> </span><span class="nv">$inp</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">inp</span><span class="p">%.*</span><span class="si">}</span>.out
</span><span id="__span-3-18"><span class="k">done</span>
</span><span id="__span-3-19">
</span><span id="__span-3-20"><span class="c1"># Extract for each output file the values of the energy cut-off</span>
</span><span id="__span-3-21"><span class="c1"># and the final total energy</span>
</span><span id="__span-3-22"><span class="c1"># Paste results in etot_v_ecut.dat file</span>
</span><span id="__span-3-23">awk<span class="w"> </span><span class="s1">&#39;/kinetic-energy/{ecut=$4}</span>
</span><span id="__span-3-24"><span class="s1">     /^!.*total/{print ecut, $5}&#39;</span><span class="w"> </span>*out<span class="w"> </span>&gt;<span class="w"> </span>etot_v_ecut.dat
</span></code></pre></div></td></tr></table></div></p>
<p>Here we've combined the two scripts we created above, and also automated the
generation of input files using the
<a href="../../extras/misc/linuxcommands/readme/#sed"><code>sed</code></a> command. This can be used to
search for and replace some text in a file. We have set up a template input file
<a href="../02_ecut/02_methane/CH4_base.in"><code>CH4_base.in</code></a> where we have used the
placeholder text <code>xxxx</code> as the text we'll search for and replace with energy
cut-off we want for our input file. The bash construction <code>for val in
{10..50..5}</code> will create a loop where the value stored in the variable <code>$val</code>
runs from 10 to 50 in steps of 5.</p>
<h3 id="task_2"><em>Task</em></h3>
<ul>
<li>Run this script and see what input and output files are generated.</li>
</ul>
<h2 id="plotting-with-gnuplot">Plotting with Gnuplot</h2>
<p>It's often useful to be able to generate a quick plot when testing the
relation between variables. <code>gnuplot</code> is a useful tool for generating plots,
particularly as it is also scriptable, so we could extend our earlier script
to automatically generate a plot from from the extracted data. There is a more
detailed overview in the <a href="../../extras/misc/gnuplot/readme/">gnuplot section</a>.</p>
<p>We can launch gnuplot by typing <code>gnuplot</code> in a terminal. Once it opens, we
can, for example, plot a data file by typing <code>plot "etot_v_ecut.dat"</code>
(provided we are in the directory containing that file). This will only plot
the points by default. If we want to join these up with lines we can type
<code>plot "etot_v_ecut.dat" with linespoints</code>, or <code>p "etot_v_ecut.dat" w lp</code>.
If you want to specify different columns of data, you can do for example
<code>p "etot_v_ecut.dat" u 2:1 w lp</code> to plot column 2 vs. 1 instead of 1 vs. 2
(which is the default).</p>
<h3 id="task_3"><em>Task</em></h3>
<ul>
<li>Generate plots of the difference between the total energy and its most
  converged value versus plane wave energy cut-off for both methane and
  carbon dioxide.<ul>
<li>Instead of working out energy differences yourself, you can plot the
  difference in energies directly in gnuplot, for example
  by doing <code>eref=-100; p "etot_v_ecut.dat" u 1:($2-eref) w lp</code>, where 
  in this case we are calculating the energy relative to -100.
  You should change the value of <code>eref</code> from -100 to the energy of
  the calculation with the highest plane-wave cut-off.</li>
<li>It can also be useful to plot convergence on a logscale, which you can do
  in gnuplot by typing <code>set logscale y</code> before you type the above command.</li>
</ul>
</li>
<li>How does the behaviour compare between the two molecules?</li>
</ul>
<h2 id="exchange-correlation-functional">Exchange &amp; Correlation Functional</h2>
<p>The exchange and correlation is a key part of DFT. The functional we use
determines how we approximate all the many body interactions. By default,
within Quantum Espresso, the exchange and correlation functionals that are
used are taken from the header of the pseudopotential file as mentioned above.
It's possible to override this using the <code>input_dft</code> variable in the system
section, but it's best to use the same approximation as was used in the
pseudopotential generation.</p>
<p>The exchange correlation can have a big impact on a number of parameters.
In this example we consider the example of an argon dimer.  By varying the bond
length between two argon atoms we can plot binding energy curves. This is 
another example where shell scripting can be very useful, since we want to run
several similar calculations. We can modify the script we used for the cut-off
energy convergence to do this. We again define a template input file, found in
<a href="../03_argon/01_lda/Ar2_base.in"><code>Ar2_base.in</code></a> and then use the following script,
which can be found in the <code>03_argon/01_lda</code> directory. In this case we want more
data points in some places than others, so we directly specify each distance we
want to calculate. There are also some other differences from the previous script -
in this case we take the value of <em>r</em> that we set and directly print it using the
command <code>echo</code>, rather than extracting it from the Quantum Espresso output, but
otherwise the same principles apply.</p>
<p>The script for LDA is as follows:
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-4-2">
</span><span id="__span-4-3"><span class="c1"># Original filename</span>
</span><span id="__span-4-4"><span class="nv">template</span><span class="o">=</span><span class="s2">&quot;Ar2_base.in&quot;</span>
</span><span id="__span-4-5"><span class="c1"># String to be replaced</span>
</span><span id="__span-4-6"><span class="nv">repstr</span><span class="o">=</span><span class="s2">&quot;xxxx&quot;</span>
</span><span id="__span-4-7">
</span><span id="__span-4-8"><span class="c1"># delete the file if it exists already (-f)</span>
</span><span id="__span-4-9">rm<span class="w"> </span>-f<span class="w"> </span>etot_v_r.dat
</span><span id="__span-4-10">
</span><span id="__span-4-11"><span class="c1"># Loop over bond lengths</span>
</span><span id="__span-4-12"><span class="k">for</span><span class="w"> </span>val<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.0<span class="w"> </span><span class="m">3</span>.1<span class="w"> </span><span class="m">3</span>.2<span class="w"> </span><span class="m">3</span>.3<span class="w"> </span><span class="m">3</span>.4<span class="w"> </span><span class="m">3</span>.5<span class="w"> </span><span class="m">3</span>.6<span class="w"> </span><span class="m">3</span>.7<span class="w"> </span><span class="m">3</span>.8<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span><span class="m">4</span>.2<span class="w"> </span><span class="m">4</span>.5<span class="w"> </span><span class="m">5</span>.0
</span><span id="__span-4-13"><span class="k">do</span>
</span><span id="__span-4-14"><span class="w">  </span><span class="c1"># Print message to output</span>
</span><span id="__span-4-15"><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Calculating Ar dimer with r=</span><span class="si">${</span><span class="nv">val</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-16"><span class="w">  </span><span class="c1"># Define input file with specific name</span>
</span><span id="__span-4-17"><span class="w">  </span><span class="nv">inp</span><span class="o">=</span><span class="s2">&quot;Ar2_r</span><span class="si">${</span><span class="nv">val</span><span class="si">}</span><span class="s2">.in&quot;</span>
</span><span id="__span-4-18"><span class="w">  </span><span class="c1"># Substitue &#39;xxxx&#39; string with current bondlength value</span>
</span><span id="__span-4-19"><span class="w">  </span><span class="c1"># and paste result in new input file</span>
</span><span id="__span-4-20"><span class="w">  </span>sed<span class="w"> </span><span class="s2">&quot;s/</span><span class="nv">$repstr</span><span class="s2">/</span><span class="nv">$val</span><span class="s2">/&quot;</span><span class="w"> </span><span class="nv">$template</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$inp</span>
</span><span id="__span-4-21"><span class="w">  </span><span class="c1"># Run pw.x on the new input file and save results in </span>
</span><span id="__span-4-22"><span class="w">  </span><span class="c1"># output file with same rootname as input file</span>
</span><span id="__span-4-23"><span class="w">  </span>pw.x<span class="w"> </span>&lt;<span class="w"> </span><span class="nv">$inp</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">inp</span><span class="p">%.*</span><span class="si">}</span>.out
</span><span id="__span-4-24"><span class="w">  </span><span class="c1"># Save current bondlength value in etot_v_r.dat file</span>
</span><span id="__span-4-25"><span class="w">  </span><span class="nb">echo</span><span class="w"> </span>-en<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">val</span><span class="si">}</span><span class="s2">\t&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>etot_v_r.dat
</span><span id="__span-4-26"><span class="w">  </span><span class="c1"># Extract cut-off and total energy and append to etot_v_r.dat file</span>
</span><span id="__span-4-27"><span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;/^!.*total/{print ecut, $5}&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">inp</span><span class="p">%.*</span><span class="si">}</span>.out<span class="w"> </span>&gt;&gt;<span class="w"> </span>etot_v_r.dat
</span><span id="__span-4-28"><span class="k">done</span>
</span></code></pre></div></td></tr></table></div></p>
<h3 id="task_4"><em>Task</em></h3>
<ul>
<li>Run this script and see what input and output files are generated.<ul>
<li>In order to save computer time the box size and cut-off have been
  chosen for speed rather than accuracy. If you have time, try converging
  these values properly. On the other hand, if the calculations take too
  long then reduce the number of data points by removing some distances.</li>
</ul>
</li>
<li>See how the total energy varies with the distance between atoms.</li>
</ul>
<p>Now we want to try a different functional.  In the directory <code>03_argon/02_pbe</code>
an input file is present that is identical to the previous calculation, except
we specify a different pseudopotential here: <code>Ar.pbe-n-rrkjus_psl.1.0.0.UPF</code>.</p>
<h3 id="task_5"><em>Task</em></h3>
<ul>
<li>Look at this file, and compare the header section to the pseudopotential you
  used previously. You'll notice a line mentioning "PBE Exchange-Correlation
  functional" in the pseudopotential we're using here, where it said "PZ
  Exchange-Correlation functional previously".<ul>
<li>Here PZ refers to a particular parametrisation of the Local Density
  Approximation (LDA) - the simplest approximation for the exchange and
  correlation, while PBE is more advanced approximation (though not
  necessarily better performing), which is classed as a Generalized
  Gradient Approximation (GGA). The letters PZ and PBE are the initials of
  the authors of the papers in which the particular approximations were
  published.</li>
</ul>
</li>
<li>Run the script for PBE.</li>
<li>Plot distance vs. length for both PBE and LDA using the gnuplot script
  <code>plot_ar.gp</code> in the <code>03_argon</code> directory, by typing <code>gnuplot plot_ar.gp</code>. This
  will generate a file called <code>ar_dimer.eps</code>. You can view this file for example
  using the program <code>evince</code> if you type <code>evince ar_dimer.eps</code>. How do the two
  functionals compare?</li>
</ul>
<hr />
<h2 id="summary">Summary</h2>
<ul>
<li>In this lab we looked at defining pseudopotentials, checking the convergence of
  the total energy with respect to the plane-wave energy cut-off, and the effect
  of exchange and correlation functional.<ul>
<li>Convergence of any parameter is done by systematically varying the
  corresponding calculation parameter and looking at how the result changes.</li>
</ul>
</li>
<li>We saw how we can use bash scripts to automate this process.<ul>
<li>This means we don't need to manually create a number of almost identical
  input files, and manually go through each one to find the values we
  want.</li>
<li>We can use a bash <code>for</code> loop to perform a calculation for a number of
  input files.</li>
<li>We can use <code>grep</code> or <code>awk</code> to parse results or parameters from our
  output files.</li>
<li>We can use <code>sed</code> to replace values in a template input file.</li>
</ul>
</li>
<li>We can quickly generate a plot of a data file with <code>gnuplot</code>.</li>
</ul>
<hr />
<h2 id="extra">Extra</h2>
<h3 id="box-size"><em>Box-Size</em></h3>
<p>For systems which are not periodic in three dimensions, such as molecules which 
we are calculating within a box, we also need to test the convergence with respect
to the box size. In other words, we need to check that the spurious interaction
between periodic images is sufficiently small for the accuracy we desire. We would
also have to do something similar with for example 2D systems, where we would have
empty space in one direction.</p>
<h3 id="optional-task"><em>Optional Task</em></h3>
<ul>
<li>Create a folder called <code>04_spacing/01_methane_20</code> and test the convergence
  of total energy versus box dimension for an energy cut-off of 20 Ry. And
  then create a folder called <code>04_spacing/01_methane_60</code> and test the
  convergence of total energy versus box dimension for an energy cut-off of 60
  Ry.<ul>
<li>How do these compare?</li>
</ul>
</li>
</ul>
<h3 id="advanced-shell-scripting"><em>Advanced Shell scripting</em></h3>
<p>If you're interested in reading more about scripting, you can take a look at the
<a href="../../extras/misc/shellscripting/readme/">shellscripting section</a>. We'll provide
plenty of examples and keep things relatively simple in the course, but you may
find some of the more advanced functionality useful in your own work.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Johannes Lischner
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.annotate", "navigation.sections", "navigation.top", "navigation.expand"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>